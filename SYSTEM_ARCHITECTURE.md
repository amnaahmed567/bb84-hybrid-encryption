# ğŸ” BB84 Quantum Encryption System - Complete Architecture

## ğŸ“‹ Table of Contents
1. [System Overview](#system-overview)
2. [Architecture Diagram](#architecture-diagram)
3. [Module Breakdown](#module-breakdown)
4. [Workflow Diagrams](#workflow-diagrams)
5. [Security Layers](#security-layers)
6. [Data Flow](#data-flow)

---

## ğŸ¯ System Overview

The BB84 Quantum Encryption Tool is a **post-quantum secure file encryption system** that combines:
- **BB84 Quantum Key Distribution (QKD)** for key generation
- **Three AEAD cipher options** (AES-GCM, ChaCha20-Poly1305, AES-SIV)
- **Dilithium5 post-quantum signatures** for authentication
- **HKDF key derivation** for cryptographic key stretching

### Key Features
âœ… **Quantum-safe key distribution** using BB84 protocol simulation  
âœ… **Three encryption modes** for different use cases  
âœ… **Post-quantum digital signatures** (Dilithium5)  
âœ… **Misuse-resistant option** (AES-SIV with no nonce)  
âœ… **Automatic performance reporting** with comparison analysis  
âœ… **Realistic QKD channel model** (noise, loss, dark counts, partial intercept-resend, adjustable shots)  
âœ… **Cross-platform GUI** (Tkinter)  

---

## ğŸ—ï¸ Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BB84 QUANTUM ENCRYPTION SYSTEM                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              LAYER 1: USER INTERFACE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  gui/bb84_gui.py - Tkinter GUI Application                           â”‚  â”‚
â”‚  â”‚  - File selection dialogs                                            â”‚  â”‚
â”‚  â”‚  - Cipher selection dropdown (AES-GCM / ChaCha20 / AES-SIV)         â”‚  â”‚
â”‚  â”‚  - Key management (generate, save, load)                            â”‚  â”‚
â”‚  â”‚  - Encrypt/Decrypt buttons                                           â”‚  â”‚
â”‚  â”‚  - Progress feedback & error handling                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â†•                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  start_gui.py - Application Entry Point                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LAYER 2: BUSINESS LOGIC CONTROLLER                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  bb84_backend/logic/controller.py - Main Controller                  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  encrypt_file_local(filepath, key_bits, cipher="AES-GCM")           â”‚  â”‚
â”‚  â”‚    â”œâ”€ Validates inputs                                               â”‚  â”‚
â”‚  â”‚    â”œâ”€ Routes to appropriate cipher packager                          â”‚  â”‚
â”‚  â”‚    â”œâ”€ Generates encryption report PDF                                â”‚  â”‚
â”‚  â”‚    â””â”€ Returns encrypted .bb84 file                                   â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  decrypt_file_local(encrypted_path, key_bits)                        â”‚  â”‚
â”‚  â”‚    â”œâ”€ Auto-detects cipher from package version                       â”‚  â”‚
â”‚  â”‚    â”œâ”€ Routes to appropriate decryption function                      â”‚  â”‚
â”‚  â”‚    â”œâ”€ Generates decryption report PDF                                â”‚  â”‚
â”‚  â”‚    â””â”€ Returns decrypted file                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYER 3: QUANTUM KEY DISTRIBUTION (BB84)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  bb84_backend/core/bb84_quantum.py - BB84 Protocol                   â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  run_qkd():                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Preparation: Alice bits + biased bases (p_Z=0.8)             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Channel realism knobs (per-call):                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Depolarizing noise (p_depolarize) flips bits probabilistically â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Photon loss (p_loss) marks no-detection (None)            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Dark counts (dark_count) add random clicks or flips       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Intercept-resend attack on random fraction (attack_fraction) â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Measurement randomness via shots_per_qubit (e.g., 6 shots) â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Sifting: keep detected, basis-matched positions               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Sampling: sacrifice subset for QBER estimate                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  QBER: computed after sifting + sampling removal               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Finite-key: ell = n_sifted*(1-h(QBER)) - leakEC - log2(1/eps) â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Returns: (key_a, key_b, stats) with channel/attack metadata   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  run_qkd_demo():                                                     â”‚  â”‚
â”‚  â”‚    â€¢ Convenience preset (p_depolarize=0.012, p_loss=0.03, dark_count=0.01, â”‚ â”‚  â”‚
â”‚  â”‚      attack="intercept_resend", attack_fraction=0.08, shots_per_qubit=6) â”‚ â”‚  â”‚
â”‚  â”‚    â€¢ Yields realistic QBER â‰ˆ 1â€“5% every run for demonstrations      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LAYER 4: KEY DERIVATION & MANAGEMENT                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  bb84_backend/core/key_utils.py - Key Utilities                      â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  derive_aes_key_from_bits(key_bits, salt, key_length=32)            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Input: Raw BB84 bits (e.g., 4096 bits)                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚         Random salt (16 bytes)                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Process:                                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    1. Pack bits into bytes                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    2. Apply HKDF-SHA256                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚       - Extract: HMAC-based key stretching                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚       - Expand: Generate desired key length                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Output: 32-byte (256-bit) cryptographic key                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  save_key_to_file() / load_key_from_file()                           â”‚  â”‚
â”‚  â”‚    - Stores keys as "0101001..." bit strings                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LAYER 5: ENCRYPTION ENGINES (3 OPTIONS)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  OPTION 1: AES-256-GCM (Hardware Accelerated)                   â”‚        â”‚
â”‚  â”‚  bb84_backend/core/aes_engine.py                                â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚  â”‚  â”‚  aes_encrypt(data, key, aad):                             â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Generate 12-byte random nonce                        â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - AES-256-GCM with AAD                                 â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Returns: nonce + ciphertext + auth_tag (combined)    â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  aes_decrypt(encrypted, key, aad):                        â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Extract nonce (first 12 bytes)                       â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Verify auth tag + decrypt                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Raises InvalidTag if tampered                        â”‚ â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  OPTION 2: ChaCha20-Poly1305 (Software Optimized)              â”‚        â”‚
â”‚  â”‚  bb84_backend/core/chacha20_engine.py                          â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚  â”‚  â”‚  chacha20_encrypt(data, key, aad):                        â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Generate 12-byte random nonce                        â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - ChaCha20-Poly1305 with AAD                           â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Returns: nonce + ciphertext + auth_tag (combined)    â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  chacha20_decrypt(encrypted, key, aad):                   â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Extract nonce (first 12 bytes)                       â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Verify auth tag + decrypt                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Raises InvalidTag if tampered                        â”‚ â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  OPTION 3: AES-SIV (Misuse-Resistant)                          â”‚        â”‚
â”‚  â”‚  bb84_backend/core/aes_siv_engine.py                           â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚  â”‚  â”‚  aes_siv_encrypt(data, key, aad):                         â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - NO nonce needed (deterministic)                      â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Derive 64-byte key (key + key)                       â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - AES-SIV with AAD                                     â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Returns: synthetic_iv (16 bytes) + ciphertext        â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  aes_siv_decrypt(encrypted, key, aad):                    â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - NO nonce extraction needed                           â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Verify synthetic IV + decrypt                        â”‚ â”‚        â”‚
â”‚  â”‚  â”‚    - Raises InvalidTag if tampered                        â”‚ â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LAYER 6: SECURE PACKAGING (Post-Quantum Signatures)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  bb84_backend/secure_io/secure_packager.py (AES-GCM)           â”‚        â”‚
â”‚  â”‚  bb84_backend/secure_io/secure_packager_chacha20.py            â”‚        â”‚
â”‚  â”‚  bb84_backend/secure_io/secure_packager_aes_siv.py             â”‚        â”‚
â”‚  â”‚                                                                 â”‚        â”‚
â”‚  â”‚  save_encrypted_file_*(plaintext, key_bits, filename)          â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚  â”‚  â”‚  Step 1: Derive encryption key from BB84 bits            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         HKDF(key_bits, salt) â†’ 32-byte key               â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 2: Prepare internal payload                        â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         {"file_bytes": base64(plaintext)}                â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 3: Build AAD (Additional Authenticated Data)       â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         version + filename + salt (concatenated)          â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 4: Encrypt with chosen cipher                      â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         ciphertext = cipher_encrypt(payload, key, AAD)    â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 5: Generate Dilithium5 signature                   â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         pk, sk = dilithium5.generate_keypair()           â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         sign_data = AAD + ciphertext                     â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         signature = dilithium5.sign(sk, sign_data)       â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 6: Create JSON package                             â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         {                                                 â”‚ â”‚        â”‚
â”‚  â”‚  â”‚           "ciphertext": base64(...),                     â”‚ â”‚        â”‚
â”‚  â”‚  â”‚           "salt": base64(...),                           â”‚ â”‚        â”‚
â”‚  â”‚  â”‚           "nonce": base64(...),  # Not in AES-SIV        â”‚ â”‚        â”‚
â”‚  â”‚  â”‚           "version": "AES-GCM-v1" | "ChaCha20-v1" |     â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                      "AES-SIV-v1",                       â”‚ â”‚        â”‚
â”‚  â”‚  â”‚           "filename": "original.ext",                    â”‚ â”‚        â”‚
â”‚  â”‚  â”‚           "pq_signature": base64(...),                   â”‚ â”‚        â”‚
â”‚  â”‚  â”‚           "pq_public_key": base64(...)                   â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         }                                                 â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 7: Save as .bb84 file                              â”‚ â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â”‚                                                                 â”‚        â”‚
â”‚  â”‚  load_and_decrypt_bytes_*(package_bytes, key_bits)             â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚  â”‚  â”‚  Step 1: Parse JSON package                               â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 2: Verify Dilithium5 signature FIRST                â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         verify(pk, signature, AAD + ciphertext)           â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         Abort if invalid (prevent timing attacks)         â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 3: Derive decryption key                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         HKDF(key_bits, extracted_salt) â†’ 32-byte key      â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 4: Decrypt with cipher                              â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         plaintext = cipher_decrypt(ciphertext, key, AAD)  â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 5: Extract file bytes from payload                  â”‚ â”‚        â”‚
â”‚  â”‚  â”‚         JSON parse â†’ base64 decode â†’ original bytes       â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚        â”‚
â”‚  â”‚  â”‚  Step 6: Return (plaintext, metadata, integrity_ok)       â”‚ â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LAYER 7: REPORTING & METRICS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  bb84_backend/common/common.py - PDF Report Generation               â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  generate_encryption_report_pdf():                                   â”‚  â”‚
â”‚  â”‚    - BB84 metrics (key length, entropy, error rate)                 â”‚  â”‚
â”‚  â”‚    - Encryption time, file sizes, SHA-256 hashes                    â”‚  â”‚
â”‚  â”‚    - Cipher details, post-quantum signature status                  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  generate_decryption_report_pdf():                                   â”‚  â”‚
â”‚  â”‚    - Decryption time, AEAD authentication status                    â”‚  â”‚
â”‚  â”‚    - File integrity verification, SHA-256 hashes                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  auto_generate_summary.py - Aggregated Comparison Reports            â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  AutoMetricsExtractor class:                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  1. Scan results/ folder for all PDF reports                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  2. Categorize reports:                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - aes_encrypt / aes_decrypt                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - chacha_encrypt / chacha_decrypt                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - siv_encrypt / siv_decrypt                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  3. Extract metrics from each PDF                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - BB84 statistics                                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - Performance timings                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - File sizes, hashes                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  4. Generate comparison tables (3 columns):                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     | Metric | AES-GCM | ChaCha20 | AES-SIV |                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  5. Calculate performance differences:                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - "AES-GCM was 5.2% faster than ChaCha20"                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - "ChaCha20 was 3.1% faster than AES-SIV"                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  6. Verify integrity:                                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - Check all three decrypt to same SHA-256 hash            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  7. Output:                                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - FINAL_METRICS_SUMMARY.md (Markdown)                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     - FINAL_METRICS_SUMMARY.pdf (PDF)                         â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Workflow Diagrams

### QKD Realism Knobs (New)
- **Biased bases**: p_Z=0.8 (efficient BB84) for both Alice and Bob.
- **Depolarizing noise**: `p_depolarize` flips measured bits probabilistically.
- **Photon loss**: `p_loss` drops photons (no detection / removed in sifting).
- **Dark counts**: `dark_count` creates random clicks on lost photons or flips detected bits.
- **Intercept-resend (fractional)**: Eve attacks a random slice of qubits (`attack_fraction`, default 0.08) to induce realistic QBER.
- **Measurement randomness**: `shots_per_qubit` (default 6 in demo) introduces variability per qubit.
- **Demo preset**: `run_qkd_demo()` uses tuned settings to yield QBER â‰ˆ 1â€“5% every run and is called by the GUI for displayed stats.

### **ENCRYPTION WORKFLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER      â”‚
â”‚  Selects:   â”‚
â”‚ - File      â”‚
â”‚ - Cipher    â”‚
â”‚ - Key A     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GUI (bb84_gui.py)                                          â”‚
â”‚  - Validate inputs                                          â”‚
â”‚  - Load Key A bits from file                                â”‚
â”‚  - Call controller.encrypt_file_local()                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONTROLLER (controller.py)                                 â”‚
â”‚  1. Read plaintext file                                     â”‚
â”‚  2. Route to appropriate packager based on cipher selection â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ AES-GCM â”‚      â”‚ ChaCha20 â”‚      â”‚ AES-SIV  â”‚
   â”‚ Packagerâ”‚      â”‚ Packager â”‚      â”‚ Packager â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  KEY DERIVATION (key_utils.py)         â”‚
        â”‚  - Generate random salt                â”‚
        â”‚  - HKDF(Key A bits, salt) â†’ 32-byte keyâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ENCRYPTION ENGINE                     â”‚
        â”‚  - Prepare AAD (version+filename+salt) â”‚
        â”‚  - Generate nonce (if needed)          â”‚
        â”‚  - Encrypt: plaintext â†’ ciphertext     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  POST-QUANTUM SIGNATURE                â”‚
        â”‚  - Generate Dilithium5 keypair         â”‚
        â”‚  - Sign: AAD + ciphertext              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  JSON PACKAGING                        â”‚
        â”‚  {                                     â”‚
        â”‚    "ciphertext": "...",                â”‚
        â”‚    "salt": "...",                      â”‚
        â”‚    "nonce": "..." (if applicable),     â”‚
        â”‚    "version": "AES-GCM-v1",           â”‚
        â”‚    "filename": "original.ext",         â”‚
        â”‚    "pq_signature": "...",              â”‚
        â”‚    "pq_public_key": "..."              â”‚
        â”‚  }                                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SAVE TO DISK                          â”‚
        â”‚  - Write .bb84 file                    â”‚
        â”‚  - Generate PDF report                 â”‚
        â”‚  - Save Key B to file                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  OUTPUT  â”‚
               â”‚  - .bb84 â”‚
               â”‚  - Key B â”‚
               â”‚  - PDF   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **DECRYPTION WORKFLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER      â”‚
â”‚  Selects:   â”‚
â”‚ - .bb84 fileâ”‚
â”‚ - Key B     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GUI (bb84_gui.py)                                          â”‚
â”‚  - Validate inputs                                          â”‚
â”‚  - Load Key B bits from file                                â”‚
â”‚  - Call controller.decrypt_file_local()                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONTROLLER (controller.py)                                 â”‚
â”‚  1. Read .bb84 file                                         â”‚
â”‚  2. Parse JSON package                                      â”‚
â”‚  3. Auto-detect cipher from "version" field:               â”‚
â”‚     - "AES-GCM-v1" â†’ AES-GCM packager                      â”‚
â”‚     - "ChaCha20-v1" â†’ ChaCha20 packager                    â”‚
â”‚     - "AES-SIV-v1" â†’ AES-SIV packager                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ AES-GCM â”‚      â”‚ ChaCha20 â”‚      â”‚ AES-SIV  â”‚
   â”‚ Packagerâ”‚      â”‚ Packager â”‚      â”‚ Packager â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SIGNATURE VERIFICATION (VERIFY FIRST!)â”‚
        â”‚  - Extract public key from package     â”‚
        â”‚  - Verify Dilithium5 signature         â”‚
        â”‚  - Abort if invalid (timing-safe)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  KEY DERIVATION (key_utils.py)         â”‚
        â”‚  - Extract salt from package           â”‚
        â”‚  - HKDF(Key B bits, salt) â†’ 32-byte keyâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  REBUILD AAD                           â”‚
        â”‚  - AAD = version + filename + salt     â”‚
        â”‚  - Must match original AAD             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  DECRYPTION ENGINE                     â”‚
        â”‚  - Extract nonce (if applicable)       â”‚
        â”‚  - Decrypt: ciphertext â†’ plaintext     â”‚
        â”‚  - Verify AEAD authentication tag      â”‚
        â”‚  - Raise InvalidTag if tampered        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  EXTRACT PAYLOAD                       â”‚
        â”‚  - Parse internal JSON                 â”‚
        â”‚  - Decode base64 file bytes            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SAVE DECRYPTED FILE                   â”‚
        â”‚  - Restore original filename           â”‚
        â”‚  - Write decrypted bytes               â”‚
        â”‚  - Generate PDF report                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  OUTPUT  â”‚
               â”‚  - File  â”‚
               â”‚  - PDF   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **BB84 QUANTUM KEY DISTRIBUTION PROTOCOL**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BB84 KEY DISTRIBUTION PROTOCOL                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   ALICE                              CHANNEL                           BOB
   
1. PREPARATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Generate    â”‚
   â”‚ random bits â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ [0,1,0,1..] â”‚                                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
   â”‚ Generate    â”‚                                              â”‚
   â”‚ random basesâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ [0,1,0,0..] â”‚  0=Rectilinear (+)  1=Diagonal (Ã—)          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
                                                                 â”‚
2. ENCODING                                                      â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
   â”‚ Encode qubits                                              â”‚
   â”‚ bit=0,basis=0 â†’ |0âŸ©  (horizontal)                         â”‚
   â”‚ bit=1,basis=0 â†’ |1âŸ©  (vertical)                           â”‚
   â”‚ bit=0,basis=1 â†’ |+âŸ©  (diagonal /)                         â”‚
   â”‚ bit=1,basis=1 â†’ |âˆ’âŸ©  (diagonal \)                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
          â”‚                                                      â”‚
3. TRANSMISSION                                                  â”‚
          â”‚                                                      â”‚
          â”‚    Quantum                                           â”‚
          â”‚    Channel    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
          â”‚    (photons)                              â”‚          â”‚
          â”‚    [|0âŸ©,|+âŸ©,|0âŸ©,|âˆ’âŸ©,...]                â”‚          â”‚
          â”‚                                           â”‚          â”‚
          â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Eavesdropper Eve?â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                     â”‚ (Introduces      â”‚                        â”‚
                     â”‚  errors ~25%)    â”‚                        â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                                                                  â”‚
                                                                  â–¼
4. MEASUREMENT                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚ Generate random  â”‚
                                                  â”‚ measurement basesâ”‚
                                                  â”‚ [1,1,0,1,...]    â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚ Measure qubits   â”‚
                                                  â”‚ with Bob's bases â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
5. BASIS RECONCILIATION (PUBLIC CHANNEL)                   â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”            "My bases were:"           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Alice sends â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Bob receivesâ”‚
   â”‚ her bases   â”‚            [0,1,0,0,1,1,...]          â”‚ Alice bases â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                                      â”‚
          â”‚                "Keep bits where bases match"        â”‚
          â”‚                "Discard ~50% of bits"               â”‚
          â”‚                                                      â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Key A:      â”‚                                        â”‚ Key B:      â”‚
   â”‚ [0,1,0,1,1] â”‚â—€â”€â”€â”€â”€â”€ Should be identical â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ [0,1,0,1,1] â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        (if no eavesdropper)            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                                      â”‚
          â”‚                                                      â”‚
6. ERROR DETECTION (PUBLIC CHANNEL - Sample subset)              â”‚
          â”‚                                                      â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        "Let's compare 10% of bits"    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Alice sends â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Bob comparesâ”‚
   â”‚ sample bits â”‚        [bit 5, bit 12, bit 23...]     â”‚ his bits    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
                                                          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                                          â”‚ Calculate   â”‚
                                                          â”‚ error rate  â”‚
                                                          â”‚ QBER < 11%? â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ QBER > 11%? â”‚
                    â”‚ ABORT!      â”‚â”€â”€â–¶ Eavesdropper detected
                    â”‚ (Eve likely)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ QBER OK
                           â–¼
7. PRIVACY AMPLIFICATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Hash final   â”‚                                       â”‚ Hash final  â”‚
   â”‚ key with     â”‚                                       â”‚ key with    â”‚
   â”‚ SHA-256      â”‚                                       â”‚ SHA-256     â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                                      â”‚
          â–¼                                                      â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Final Key A â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Identical Keys â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Final Key B â”‚
   â”‚ (4096 bits) â”‚        (Used for encryption)          â”‚ (4096 bits) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ Security Layers

### **1. Quantum-Safe Key Distribution**
- **BB84 Protocol** ensures any eavesdropper introduces detectable errors
- **QBER Threshold**: Abort if error rate > 11%
- **Privacy Amplification**: Hashes final key to remove partial information leaked during error checking

### **2. Cryptographic Key Derivation**
- **HKDF-SHA256**: Industry-standard key derivation function
- **Random Salt**: 16 bytes per encryption (prevents rainbow table attacks)
- **Key Stretching**: Expands quantum bits into full 256-bit keys

### **3. Authenticated Encryption (AEAD)**
- **Three Cipher Options**:
  - AES-256-GCM (NIST standard, hardware accelerated)
  - ChaCha20-Poly1305 (RFC 8439, software optimized)
  - AES-SIV (RFC 5297, misuse-resistant)
- **AAD Protection**: Metadata authenticated (prevents tampering)
- **Authentication Tags**: Cryptographically verify integrity

### **4. Post-Quantum Digital Signatures**
- **Dilithium5 (CRYSTALS-Dilithium)**: NIST PQC standard
- **Signature Scheme**: ML-DSA (Module-Lattice-Based Digital Signature Algorithm)
- **Security Level**: NIST Level 5 (highest security)
- **Verify-Before-Decrypt**: Signature checked FIRST (prevents timing attacks)

### **5. Secure Packaging**
- **JSON Format**: Structured, parseable, extensible
- **Base64 Encoding**: Binary-safe transport
- **Version Field**: Enables cipher auto-detection
- **Metadata Integrity**: Filename, salt, nonce all authenticated

---

## ğŸ“Š Data Flow Summary

### **Encryption Path**
```
User File â†’ GUI â†’ Controller â†’ BB84 Key Gen â†’ Key Derivation (HKDF) 
â†’ Cipher Engine (AES-GCM/ChaCha20/AES-SIV) â†’ Dilithium5 Signature 
â†’ JSON Package â†’ .bb84 File + PDF Report
```

### **Decryption Path**
```
.bb84 File â†’ GUI â†’ Controller â†’ Parse JSON â†’ Verify Dilithium5 Signature 
â†’ Key Derivation (HKDF) â†’ Cipher Engine â†’ Extract Payload 
â†’ Decrypted File + PDF Report
```

### **Performance Analysis Path**
```
Multiple PDF Reports â†’ auto_generate_summary.py â†’ Extract Metrics 
â†’ Categorize by Cipher â†’ Compare Performance â†’ Generate Tables 
â†’ Markdown + PDF Summary
```

---

## ğŸ¯ Module Responsibilities

| Module | Responsibility | Key Functions |
|--------|----------------|---------------|
| `start_gui.py` | Application entry point | Launch GUI |
| `gui/bb84_gui.py` | User interface | File selection, key management, encrypt/decrypt buttons, **demo QBER via `run_qkd_demo()`** |
| `bb84_backend/logic/controller.py` | Business logic orchestration | `encrypt_file_local()`, `decrypt_file_local()` |
| `bb84_backend/core/bb84_quantum.py` | Quantum key distribution | `run_qkd()` (channel knobs: depolarize, loss, dark count, attack_fraction, shots_per_qubit), `run_qkd_demo()` |
| `bb84_backend/core/key_utils.py` | Key management | `derive_aes_key_from_bits()`, `save_key_to_file()` |
| `bb84_backend/core/aes_engine.py` | AES-GCM encryption | `aes_encrypt()`, `aes_decrypt()` |
| `bb84_backend/core/chacha20_engine.py` | ChaCha20 encryption | `chacha20_encrypt()`, `chacha20_decrypt()` |
| `bb84_backend/core/aes_siv_engine.py` | AES-SIV encryption | `aes_siv_encrypt()`, `aes_siv_decrypt()` |
| `bb84_backend/secure_io/secure_packager*.py` | Secure packaging + signatures | `save_encrypted_file_*()`, `load_and_decrypt_bytes_*()` |
| `bb84_backend/common/common.py` | Reporting utilities | `generate_encryption_report_pdf()`, `generate_decryption_report_pdf()` |
| `auto_generate_summary.py` | Performance aggregation | Extract metrics, generate comparison reports |

---

## ğŸ”„ Cipher Comparison Matrix

| Feature | AES-256-GCM | ChaCha20-Poly1305 | AES-256-SIV |
|---------|-------------|-------------------|-------------|
| **Standard** | NIST SP 800-38D | RFC 8439 | RFC 5297 |
| **Key Size** | 256 bits | 256 bits | 512 bits (2Ã—256) |
| **Nonce** | 12 bytes random | 12 bytes random | None (deterministic) |
| **Speed** | Very fast (with AES-NI) | Fast (software) | Slower (two-pass) |
| **Hardware Support** | Yes (AES-NI) | No | Yes (AES-NI) |
| **Misuse Resistance** | No (nonce reuse = broken) | No (nonce reuse = broken) | Yes (safe) |
| **Best For** | Desktop/server with AES-NI | Mobile/ARM without AES-NI | Research/high-security |
| **Nonce Reuse Impact** | ğŸ”´ Critical (key recovery) | ğŸ”´ Critical (key recovery) | ğŸŸ¢ Safe (same ciphertext) |
| **Use Case** | Production (careful nonce mgmt) | Production (careful nonce mgmt) | Research/critical systems |

---

## ğŸ“ File Format Specification

### **.bb84 Package Format**
```json
{
  "ciphertext": "base64_encoded_encrypted_data",
  "salt": "base64_encoded_16_byte_salt",
  "nonce": "base64_encoded_12_byte_nonce",  // Optional: Not in AES-SIV
  "version": "AES-GCM-v1" | "ChaCha20-v1" | "AES-SIV-v1",
  "filename": "original_filename.extension",
  "pq_signature": "base64_encoded_dilithium5_signature",
  "pq_public_key": "base64_encoded_dilithium5_public_key"
}
```

### **Key File Format**
```
01010011010100110101001101010011010100110101001101010011...
(4096 bits represented as ASCII '0' and '1' characters)
```

---

## ğŸ“ Educational Value

This system demonstrates:

1. **Quantum Cryptography**: BB84 protocol simulation with realistic quantum channel behavior
2. **Post-Quantum Cryptography**: Lattice-based Dilithium5 signatures (NIST PQC)
3. **Modern AEAD Ciphers**: Three industry-standard authenticated encryption schemes
4. **Key Derivation**: HKDF-SHA256 for secure key expansion
5. **Secure Software Design**: 
   - Verify-before-decrypt
   - Constant-time operations
   - Defense in depth
6. **Performance Analysis**: Scientific comparison methodology with statistical reporting

---

## ğŸš€ Usage Example

```python
# 1. Generate quantum keys
key_a, key_b = BB84KeyDistribution.distribute_key(n_bits=4096)

# 2. Encrypt file with AES-SIV
encrypted_path = encrypt_file_local(
    filepath="document.pdf",
    key_a_bits=key_a,
    cipher="AES-SIV"
)
# Output: AES-SIV_document_E.bb84

# 3. Decrypt with Key B
decrypted_path = decrypt_file_local(
    encrypted_path="AES-SIV_document_E.bb84",
    key_b_bits=key_b
)
# Output: document.pdf (restored)

# 4. Generate comparison report
python auto_generate_summary.py
# Output: FINAL_METRICS_SUMMARY.md + .pdf
```

---

## ğŸ“ˆ Performance Metrics Collected

- **BB84 Statistics**: Key length, entropy, error rate, match percentage
- **Encryption Metrics**: Time, original size, encrypted size, throughput
- **Decryption Metrics**: Time, decrypted size, authentication status
- **Integrity Verification**: SHA-256 hashes, signature validation
- **Comparative Analysis**: Speed differences, efficiency ratios

---

## ğŸ” Security Considerations

### **Strengths**
âœ… Quantum-safe key distribution (BB84)  
âœ… Post-quantum authentication (Dilithium5)  
âœ… Three battle-tested AEAD ciphers  
âœ… Misuse-resistant option (AES-SIV)  
âœ… Verify-before-decrypt prevents timing attacks  
âœ… Metadata authentication (AAD)  

### **Limitations**
âš ï¸ BB84 is simulated (not real quantum hardware)  
âš ï¸ AES-GCM/ChaCha20 vulnerable to nonce reuse (use AES-SIV if concerned)  
âš ï¸ Keys stored as plaintext files (protect with OS-level encryption)  
âš ï¸ No key rotation mechanism (manual key management)  

---

## ğŸ“š Standards & References

- **BB84 Protocol**: Bennett & Brassard (1984) - Quantum Cryptography
- **AES-GCM**: NIST SP 800-38D
- **ChaCha20-Poly1305**: RFC 8439
- **AES-SIV**: RFC 5297
- **HKDF**: RFC 5869
- **Dilithium**: NIST PQC Round 3 Finalist (ML-DSA)

---

**System Status**: âœ… Fully operational with three quantum-safe encryption modes
